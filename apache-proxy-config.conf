# Apache Reverse Proxy Configuration for MapIt
# This file configures Apache to forward /api/* requests to the Node.js backend
# running on localhost:3101

# Enable required proxy modules
# Run: a2enmod proxy
# Run: a2enmod proxy_http
# Run: a2enmod rewrite

# Add this to your Apache VirtualHost configuration for mapit.optimalservers.online
# or to /etc/apache2/sites-available/yourdomain.conf

# Reverse Proxy Configuration
ProxyPreserveHost On
ProxyPass /api http://127.0.0.1:3101/api
ProxyPassReverse /api http://127.0.0.1:3101/api

# Allow proxy for /api paths
<Location /api>
  Order allow,deny
  Allow from all
</Location>

# WebSocket support (if needed for future features)
<IfModule mod_rewrite.c>
  # This is already in .htaccess for SPA routing, keeping for reference
  RewriteEngine On
  RewriteBase /
  
  # Don't rewrite real files or directories
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  
  # Don't rewrite /api requests - let them through to the proxy
  RewriteCond %{REQUEST_URI} !^/api/
  
  # Rewrite everything else to index.html for SPA routing
  RewriteRule ^(.*)$ index.html [QSA,L]
</IfModule>

# Set correct headers for proxied requests
<IfModule mod_headers.c>
  # Allow CORS headers to pass through
  Header edit Set-Cookie ^(.*)$ "$1; Path=/"
</IfModule>
